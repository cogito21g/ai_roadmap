### 17주차: 부트로더 작성

**강의 목표:**  
부트로더의 개념과 필요성을 이해하고, 부트로더를 설계하며, 간단한 부트로더를 작성하고 애플리케이션 코드를 로드하는 방법을 학습합니다.

**강의 내용:**

1. **부트로더 개념 및 필요성**
   - 부트로더의 정의와 역할
   - 부트로더가 필요한 이유
   - 부트로더의 주요 기능

2. **부트로더 설계**
   - 부트로더와 애플리케이션 코드의 분리
   - 부트로더의 메모리 맵 설계
   - 부트로더와 애플리케이션 코드의 상호작용 방법

3. **부트로더 작성**
   - 부트로더 코드 작성 방법
   - 부트로더에서 애플리케이션 코드 로드 및 실행
   - 에러 처리 및 복구 방법

4. **부트로더와 애플리케이션 통합 예제**
   - 간단한 부트로더 작성 예제
   - 애플리케이션 코드 작성 및 로드 예제
   - 부트로더와 애플리케이션 코드의 통합 테스트

**실습 내용:**

1. **부트로더 코드 작성**
   - 간단한 부트로더 코드를 작성하고 테스트

2. **애플리케이션 코드 작성**
   - 부트로더에 의해 로드될 애플리케이션 코드를 작성

3. **부트로더와 애플리케이션 통합**
   - 부트로더와 애플리케이션 코드를 통합하여 테스트

---

**강의 진행:**

1. **강의 시작 (10분)**
   - 강의 목표와 주제를 소개합니다.
   - 부트로더의 개념과 필요성을 설명합니다.

2. **부트로더 개념 및 필요성 (20분)**
   - 부트로더의 정의와 역할을 설명합니다.
   - 부트로더가 필요한 이유와 주요 기능을 설명합니다.

3. **부트로더 설계 (30분)**
   - 부트로더와 애플리케이션 코드의 분리 방법을 설명합니다.
   - 부트로더의 메모리 맵 설계 방법을 설명합니다.
   - 부트로더와 애플리케이션 코드의 상호작용 방법을 설명합니다.

4. **부트로더 작성 (30분)**
   - 부트로더 코드 작성 방법을 설명합니다.
   - 부트로더에서 애플리케이션 코드 로드 및 실행 방법을 시연합니다.
   - 에러 처리 및 복구 방법을 설명합니다.

5. **부트로더와 애플리케이션 통합 예제 (20분)**
   - 간단한 부트로더 작성 예제를 시연합니다.
   - 애플리케이션 코드 작성 및 로드 예제를 시연합니다.
   - 부트로더와 애플리케이션 코드의 통합 테스트를 시연합니다.

6. **Q&A 및 실습 준비 (10분)**
   - Q&A 시간을 통해 학생들의 질문에 답변하고, 이해도를 확인합니다.
   - 실습을 위한 준비 사항을 안내합니다.

**실습 내용:**

1. **부트로더 코드 작성**

**부트로더 코드 예제:**

```c
#include "stm32f4xx_hal.h"

// 함수 선언
void SystemClock_Config(void);
void JumpToApplication(void);

int main(void) {
    // HAL 라이브러리 초기화
    HAL_Init();
    // 시스템 클록 설정
    SystemClock_Config();
    // UART 초기화 (디버깅 용도)
    MX_USART2_UART_Init();

    // 부트로더 메시지 출력
    printf("Bootloader started...\n");

    // 애플리케이션 코드의 시작 주소
    uint32_t app_start_address = 0x08004000;

    // 애플리케이션으로 점프
    JumpToApplication(app_start_address);

    // 부트로더 무한 루프 (애플리케이션으로 점프 실패 시)
    while (1);
}

void JumpToApplication(uint32_t app_start_address) {
    // 애플리케이션 리셋 핸들러 함수 포인터
    void (*app_reset_handler)(void) = (void *)(*(volatile uint32_t *)(app_start_address + 4));

    // 애플리케이션의 초기 스택 포인터 설정
    __set_MSP(*(volatile uint32_t *)app_start_address);

    // 애플리케이션 리셋 핸들러 호출
    app_reset_handler();
}

// 시스템 클록 설정 함수 (자동 생성됨)
void SystemClock_Config(void) {
    // 클록 설정 코드
}
```

2. **애플리케이션 코드 작성**

**애플리케이션 코드 예제:**

```c
#include "stm32f4xx_hal.h"

// 함수 선언
void SystemClock_Config(void);

int main(void) {
    // HAL 라이브러리 초기화
    HAL_Init();
    // 시스템 클록 설정
    SystemClock_Config();
    // GPIO 초기화
    MX_GPIO_Init();

    // 애플리케이션 메시지 출력
    printf("Application started...\n");

    // 메인 루프
    while (1) {
        // LED 토글
        HAL_GPIO_TogglePin(GPIOA, GPIO_PIN_5);
        HAL_Delay(1000); // 1초 대기
    }
}

// 시스템 클록 설정 함수 (자동 생성됨)
void SystemClock_Config(void) {
    // 클록 설정 코드
}

// GPIO 초기화 함수 (자동 생성됨)
static void MX_GPIO_Init(void) {
    GPIO_InitTypeDef GPIO_InitStruct = {0};

    __HAL_RCC_GPIOA_CLK_ENABLE();

    // GPIO 핀 설정 (PA5: LED 핀)
    GPIO_InitStruct.Pin = GPIO_PIN_5;
    GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
    GPIO_InitStruct.Pull = GPIO_NOPULL;
    GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
    HAL_GPIO_Init(GPIOA, &GPIO_InitStruct);
}
```

3. **부트로더와 애플리케이션 통합**

- 부트로더 코드와 애플리케이션 코드를 통합하여 테스트합니다.
- 애플리케이션이 정상적으로 로드되고 실행되는지 확인합니다.

**과제:**

1. **부트로더 코드 작성 및 테스트**
   - 간단한 부트로더 코드를 작성하고 테스트합니다.
   - 부트로더가 애플리케이션 코드를 로드하고 실행하는지 확인합니다.
   - 작성한 코드를 업로드하고, 실행 결과를 동영상으로 촬영하여 제출합니다.

2. **애플리케이션 코드 작성 및 테스트**
   - 부트로더에 의해 로드될 애플리케이션 코드를 작성합니다.
   - 애플리케이션 코드가 정상적으로 실행되는지 확인합니다.
   - 작성한 코드를 업로드하고, 실행 결과를 동영상으로 촬영하여 제출합니다.

3. **부트로더와 애플리케이션 통합 테스트**
   - 부트로더와 애플리케이션 코드를 통합하여 테스트합니다.
   - 통합 테스트 결과를 분석하고 보고서를 작성하여 제출합니다.

이 강의 계획을 통해 학생들은 부트로더의 개념과 필요성을 이해하고, 부트로더를 설계하며, 간단한 부트로더를 작성하고 애플리케이션 코드를 로드하는 방법을 습득할 수 있습니다.
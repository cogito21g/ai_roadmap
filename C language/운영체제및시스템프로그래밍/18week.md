### 18주차: 리눅스 커널 기초

**강의 목표:** 리눅스 커널의 구조와 동작 원리를 이해하고, 커널 모듈을 작성 및 로드하는 방법을 학습합니다. 또한, 커널 디버깅 기법을 익히고 이를 통해 커널 모듈의 동작을 검증합니다.

**강의 내용:**

1. **리눅스 커널 구조**
   - 리눅스 커널이란 무엇인가?
     - 운영체제의 핵심 부분으로 하드웨어와 소프트웨어 간의 인터페이스 역할을 수행
   - 커널의 주요 구성 요소
     - 프로세스 관리, 메모리 관리, 파일 시스템, 네트워크 스택, 드라이버
   - 커널 공간 vs 사용자 공간
     - 커널 모드와 사용자 모드의 차이점

2. **커널 모듈 작성 및 로드**
   - 커널 모듈이란 무엇인가?
     - 동적으로 로드되고 언로드될 수 있는 커널 확장 기능
   - 커널 모듈의 작성
     - 기본 구조: 모듈 초기화 함수 (`init`), 모듈 종료 함수 (`exit`)
   - 커널 모듈의 빌드 및 로드
     - `Makefile` 작성, `insmod` 및 `rmmod` 명령어 사용
   - 커널 모듈 정보 확인
     - `lsmod`, `modinfo` 명령어 사용

3. **커널 디버깅 기법**
   - 커널 로그
     - `printk` 함수, `dmesg` 명령어 사용
   - 커널 디버거
     - KGDB (Kernel GNU Debugger)
   - 커널 패닉 디버깅
     - 커널 패닉 원인 분석 및 해결 방법

**실습:**

1. **간단한 리눅스 커널 모듈 작성**

**간단한 커널 모듈 코드 예제:**

```c
#include <linux/init.h>
#include <linux/module.h>
#include <linux/kernel.h>

MODULE_LICENSE("GPL");
MODULE_AUTHOR("Your Name");
MODULE_DESCRIPTION("A simple Linux kernel module");
MODULE_VERSION("0.1");

static int __init hello_init(void) {
    printk(KERN_INFO "Hello, World!\n");
    return 0;
}

static void __exit hello_exit(void) {
    printk(KERN_INFO "Goodbye, World!\n");
}

module_init(hello_init);
module_exit(hello_exit);
```

**Makefile 작성 예제:**

```Makefile
obj-m += hello.o

all:
    make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules

clean:
    make -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean
```

**커널 모듈 빌드 및 로드:**

```sh
# 모듈 빌드
make

# 모듈 로드
sudo insmod hello.ko

# 모듈 로드 확인
lsmod | grep hello

# 커널 로그 확인
dmesg | tail

# 모듈 언로드
sudo rmmod hello

# 커널 로그 확인
dmesg | tail
```

2. **커널 디버깅 기법 실습**

**`printk` 함수와 `dmesg` 명령어 사용:**

- 커널 모듈에서 `printk` 함수를 사용하여 디버깅 메시지 출력
- `dmesg` 명령어로 커널 로그 확인

**커널 패닉 발생 및 디버깅:**

- 의도적으로 커널 패닉을 발생시키는 코드 작성
- 커널 패닉 로그 분석 및 원인 파악

**과제:**

1. **고급 커널 모듈 작성**
   - 파일 시스템 관련 커널 모듈을 작성하여 파일 읽기/쓰기를 구현합니다.
   - 모듈 로드 시 특정 파일을 읽고, 모듈 언로드 시 파일 내용을 수정하여 저장합니다.

2. **커널 디버깅 도구 사용**
   - KGDB를 사용하여 커널 모듈을 디버깅합니다.
   - 커널 모듈에서 발생하는 버그를 찾아 수정하고, 수정된 모듈을 다시 빌드 및 로드합니다.

**퀴즈 및 해설:**

1. **커널 모듈의 주요 장점은 무엇인가요?**
   - 커널 모듈의 주요 장점은 커널을 재컴파일하지 않고도 기능을 동적으로 추가하거나 제거할 수 있다는 점입니다.

2. **`printk` 함수의 역할은 무엇인가요?**
   - `printk` 함수는 커널 모드에서 메시지를 출력하는 함수로, 디버깅 시 유용하게 사용됩니다.

3. **커널 패닉이 발생했을 때의 주요 디버깅 방법은 무엇인가요?**
   - 커널 패닉이 발생했을 때는 커널 로그(`dmesg`)를 확인하고, KGDB와 같은 디버깅 도구를 사용하여 원인을 분석합니다. 또한, 커널 패닉 메시지를 분석하여 문제를 해결할 수 있습니다.

**해설:**

1. **커널 모듈의 주요 장점**은 커널을 재컴파일하지 않고도 기능을 동적으로 추가하거나 제거할 수 있다는 점입니다. 이는 커널 모듈이 운영체제의 유연성과 확장성을 높이는 데 기여합니다.

2. **`printk` 함수의 역할**은 커널 모드에서 메시지를 출력하는 것입니다. `printk` 함수는 디버깅 시 유용하게 사용되며, 커널 로그(`dmesg`)를 통해 출력된 메시지를 확인할 수 있습니다.

3. **커널 패닉이 발생했을 때의 주요 디버깅 방법**은 커널 로그(`dmesg`)를 확인하고, KGDB와 같은 디버깅 도구를 사용하여 원인을 분석하는 것입니다. 커널 패닉 메시지를 분석하여 문제의 원인을 파악하고, 이를 수정함으로써 커널 패닉을 해결할 수 있습니다.

이로써 18주차 강의를 마무리합니다. 다음 주차에는 프로젝트 진행 상황 점검 및 중간 발표 준비를 학습합니다. 추가 질문이 있거나 특정 주제에 대해 더 알고 싶다면 언제든지 문의해 주세요.